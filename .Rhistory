labs(title="Survey Makeup \n by Ethnic Group (2007)",
x = 'Respondant Ethnicity',
y = 'Percentage',
fill = 'Ethnic Group',
caption = "(Test Footnote 2021)") +
theme(plot.caption = element_text(hjust = 0),
plot.title = element_text(hjust = 0.5),
axis.text.x = element_text(angle = 45, hjust=1)) +
annotate("text", x = 5, y = .9, size = 3, label = "(total n = 7,403)") +
annotate("text", x = 5, y = .8, size = 3, label = "n = 5,353")
# weighted ethnicity
ggsurvey(weight_pms07) +
(aes(x = fct_infreq(ethnic5),
y = prop.table(stat(count)),
fill = fct_infreq(ethnic5),
label = scales::percent(prop.table(stat(count))))) +
geom_bar() +
geom_text(aes(label = sprintf('%01.f (%.1f%%)', after_stat(count), after_stat(count / sum(count) * 100))), # show counts & %
stat='count',
position = position_dodge(.9),
vjust = -1,
size = 3) +
scale_y_continuous(labels = scales::label_percent(accuracy = 1)) +
labs(title="Weighted Survey Makeup (2007) \n by Ethnic Group (2007)",
x = 'Respondant Ethnicity',
y = 'Percentage',
fill = 'Ethnic Group',
caption = "(Test Footnote 2021)") +
theme(plot.caption = element_text(hjust = 0),
plot.title = element_text(hjust = 0.5),
axis.text.x = element_text(angle = 45, hjust=1)) + # angle text
annotate("text", x = 3.0, y = .85, size = 3, label = "(total n = 7,403)") +
annotate("text", x = 3.0, y = .80, size = 3, label = "n = 7,403")
# Highest Qualification
subset_pms07 %>%
filter(!edqual5 %in% c("Don't know", "No answer/refused")) %>% # drop more than 2 levels
drop_na() %>%
ggplot(aes(x = fct_infreq(edqual5),
y = prop.table(stat(count)),
fill = fct_infreq(edqual5),
label = scales::percent(prop.table(stat(count))))) +
geom_bar() +
geom_text(aes(label = sprintf('%s (%.1f%%)', after_stat(count), after_stat(count / sum(count) * 100))), # show counts & %
stat='count',
position = position_dodge(.9),
vjust = -1,
size = 3) +
scale_y_continuous(labels = scales::label_percent(accuracy = 1)) +
labs(title="Survey Makeup \n by Qualification (2007)",
x = 'Respondant Highest Qualification',
y = 'Percentage', fill = 'Qualification',
caption = "* Includes: Nursing, Teaching, HND") +
theme(plot.caption = element_text(hjust = 0),
plot.title = element_text(hjust = 0.5),
axis.text.x = element_text(angle = 45, hjust=1)) +
annotate("text", x = 6, y = .4, size = 3, label = "(total n = 7,403)") +
annotate("text", x = 6, y = .35, size = 3, label = "n = 7,235")
# weighted hi qual
ggsurvey(weight_pms07) +
(aes(x = fct_infreq(edqual5),
y = prop.table(stat(count)),
fill = fct_infreq(edqual5),
label = scales::percent(prop.table(stat(count))))) +
geom_bar() +
geom_text(aes(label = sprintf('%01.f (%.1f%%)', after_stat(count), after_stat(count / sum(count) * 100))), # show counts & %
stat='count',
position = position_dodge(.9),
vjust = -1,
size = 3) +
scale_y_continuous(labels = scales::label_percent(accuracy = 1)) +
labs(title="Weighted Survey Makeup (2007) \n by Qualification (2007)",
x = 'Respondant Highest Qualification',
y = 'Percentage',
fill = 'Qualification',
caption = "* Includes: Nursing, Teaching, HND") +
theme(plot.caption = element_text(hjust = 0),
plot.title = element_text(hjust = 0.5),
axis.text.x = element_text(angle = 45, hjust=1)) + # angle text
annotate("text", x = 3.0, y = .85, size = 3, label = "(total n = 7,403)") +
annotate("text", x = 3.0, y = .80, size = 3, label = "n = 7,403")
# Marital Status
subset_pms07 %>%
drop_na() %>%
ggplot(aes(x = fct_infreq(res_mar_df),
y = prop.table(stat(count)),
fill = fct_infreq(res_mar_df),
label = scales::percent(prop.table(stat(count))))) +
geom_bar() +
geom_text(aes(label = sprintf('%s (%.1f%%)', after_stat(count), after_stat(count / sum(count) * 100))), # show counts & %
stat='count',
position = position_dodge(.9),
vjust = -1,
size = 3) +
scale_y_continuous(labels = scales::label_percent(accuracy = 1)) +
labs(title="Survey Makeup (2007) \n by Marital Status",
x = 'Respondant Status',
y = 'Percentage', fill = 'Marital Status',
caption = "(Test Footnote 2021)") +
theme(plot.caption = element_text(hjust = 0),
plot.title = element_text(hjust = 0.5)) +
annotate("text", x = 6, y = .5, size = 3, label = "(total n = 7,403)") +
annotate("text", x = 6, y = .45, size = 3, label = "n = 7,235")
# weighted marital status
ggsurvey(weight_pms07) +
(aes(x = fct_infreq(res_mar_df),
y = prop.table(stat(count)),
fill = fct_infreq(res_mar_df),
label = scales::percent(prop.table(stat(count))))) +
geom_bar() +
geom_text(aes(label = sprintf('%01.f (%.1f%%)', after_stat(count), after_stat(count / sum(count) * 100))), # show counts & %
stat='count',
position = position_dodge(.9),
vjust = -1,
size = 3) +
scale_y_continuous(labels = scales::label_percent(accuracy = 1)) +
labs(title="Weighted Survey Makeup (2007) \n by Marital Status",
x = 'Respondant Status',
y = 'Percentage',
fill = 'Marital Status',
caption = "test") +
theme(plot.caption = element_text(hjust = 0),
plot.title = element_text(hjust = 0.5),
axis.text.x = element_text(angle = 45, hjust=1)) + # angle text
annotate("text", x = 3.0, y = .85, size = 3, label = "(total n = 7,403)") +
annotate("text", x = 3.0, y = .80, size = 3, label = "n = 7,403")
# Number of Common Mental Disorders
subset_pms07 %>%
drop_na() %>%
ggplot(aes(x = fct_infreq(numdis),
y = prop.table(stat(count)),
fill = fct_infreq(numdis),
label = scales::percent(prop.table(stat(count))))) +
geom_bar() +
geom_text(aes(label = sprintf('%s (%.1f%%)', after_stat(count), after_stat(count / sum(count) * 100))), # show counts & %
stat='count',
position = position_dodge(.9),
vjust = -1,
size = 3) +
scale_y_continuous(labels = scales::label_percent(accuracy = 1)) +
labs(title = "Survey Makeup (2007) \n by Number of CMDs Diagnosed",
x = 'Respondant Diagnosis',
y = 'Percentage',
fill = 'Number of CMD',
caption = "(Test Footnote 2021)") +
theme(plot.caption = element_text(hjust = 0),
plot.title = element_text(hjust = 0.5)) +
annotate("text", x = 3, y = .9, size = 3, label = "(total n = 7,403)") +
annotate("text", x = 3, y = .80, size = 3, label = "n = 7,403")
# weighted Number of Common Mental Disorders
ggsurvey(weight_pms07) +
(aes(x = fct_infreq(numdis),
y = prop.table(stat(count)),
fill = fct_infreq(numdis),
label = scales::percent(prop.table(stat(count))))) +
geom_bar() +
geom_text(aes(label = sprintf('%01.f (%.1f%%)', after_stat(count), after_stat(count / sum(count) * 100))), # show counts & %
stat='count',
position = position_dodge(.9),
vjust = -1,
size = 3) +
scale_y_continuous(labels = scales::label_percent(accuracy = 1)) +
labs(title="Weighted Survey Makeup (2007) \n by Number of CMDs Diagnosed",
x = 'Respondant Diagnosis',
y = 'Percentage',
fill = 'Number of CMDs',
caption = "test") +
theme(plot.caption = element_text(hjust = 0),
plot.title = element_text(hjust = 0.5),
axis.text.x = element_text(angle = 45, hjust=1)) + # angle text
annotate("text", x = 3.0, y = .85, size = 3, label = "(total n = 7,403)") +
annotate("text", x = 3.0, y = .80, size = 3, label = "n = 7,403")
# Region
subset_pms07 %>%
drop_na() %>%
ggplot(aes(x = fct_infreq(gor06),
y = prop.table(stat(count)),
fill = fct_infreq(gor06),
label = scales::percent(prop.table(stat(count))))) +
geom_bar() +
geom_text(aes(label = sprintf('%s (%.1f%%)', after_stat(count), after_stat(count / sum(count) * 100))), # show counts & %
stat='count',
position = position_dodge(.9),
vjust = -1,
size = 3) +
coord_flip() +
scale_y_continuous(labels = scales::label_percent(accuracy = 1)) +
labs(title="Survey Makeup (2007) \n by Region",
x = 'Respondants by Region',
y = 'Percentage',
fill = 'Region',
caption = "(Test Footnote 2021)") +
theme(plot.caption = element_text(hjust = 0),
plot.title = element_text(hjust = 0.5)) +
annotate("text", x = 9.5, y = .15, size = 3, label = "(total n = 7,403)") +
annotate("text", x = 9, y = .15, size = 3, label = "n = 7,403")
# weighted region
ggsurvey(weight_pms07) +
(aes(x = fct_infreq(gor06),
y = prop.table(stat(count)),
fill = fct_infreq(gor06),
label = scales::percent(prop.table(stat(count))))) +
geom_bar() +
geom_text(aes(label = sprintf('%01.f (%.1f%%)', after_stat(count), after_stat(count / sum(count) * 100))), # show counts & %
stat='count',
position = position_dodge(.9),
vjust = -1,
size = 3) +
coord_flip() +
scale_y_continuous(labels = scales::label_percent(accuracy = 1)) +
labs(title="Weighted Survey Makeup (2007) \n by by Region",
x = 'Respondant by Region',
y = 'Percentage',
fill = 'Region',
caption = "test") +
theme(plot.caption = element_text(hjust = 0),
plot.title = element_text(hjust = 0.5),
axis.text.x = element_text(angle = 45, hjust=1)) + # angle text
annotate("text", x = 3.0, y = .20, size = 3, label = "(total n = 7,403)") +
annotate("text", x = 3.3, y = .20, size = 3, label = "n = 7,403")
# Treatment for CMDs
subset_pms07 %>%
filter(trtment != "Don't know") %>%
drop_na() %>%
ggplot(aes(x = fct_infreq(trtment),
y = prop.table(stat(count)),
fill = fct_infreq(trtment),
label = scales::percent(prop.table(stat(count))))) +
geom_bar() +
geom_text(aes(label = sprintf('%s (%.1f%%)', after_stat(count), after_stat(count / sum(count) * 100))), # show counts & %
stat='count',
position = position_dodge(.9),
vjust = -1,
size = 3) +
scale_y_continuous(labels = scales::label_percent(accuracy = 1)) +
labs(title="Survey Makeup (2007) \n by CMD Treatment",
x = 'Treatment Group',
y = 'Percentage',
fill = 'Treatment',
caption = "(Test Footnote 2021)") +
theme(plot.caption = element_text(hjust = 0),
plot.title = element_text(hjust = 0.5)) +
annotate("text", x = 4, y = 1, size = 3, label = "(total n = 7,403)") +
annotate("text", x = 4, y = .95, size = 3, label = "n = 7,382")
# weighted trtmnt
ggsurvey(weight_pms07) +
(aes(x = fct_infreq(trtment),
y = prop.table(stat(count)),
fill = fct_infreq(trtment),
label = scales::percent(prop.table(stat(count))))) +
geom_bar() +
geom_text(aes(label = sprintf('%01.f (%.1f%%)', after_stat(count), after_stat(count / sum(count) * 100))), # show counts & %
stat='count',
position = position_dodge(.9),
vjust = -1,
size = 3) +
scale_y_continuous(labels = scales::label_percent(accuracy = 1)) +
labs(title="Weighted Survey Makeup (2007) \n by CMD Treatment",
x = 'Treatment Group',
y = 'Percentage',
fill = 'Treatment',
caption = "test") +
theme(plot.caption = element_text(hjust = 0),
plot.title = element_text(hjust = 0.5),
axis.text.x = element_text(angle = 45, hjust=1)) + # angle text
annotate("text", x = 3.0, y = .85, size = 3, label = "(total n = 7,403)") +
annotate("text", x = 3.0, y = .80, size = 3, label = "n = 7,403")
# Ever Took Drugs
subset_pms07 %>%
filter(!drugever %in% c("Missing data", "No answer/refused", "Don't know")) %>%
drop_na() %>%
ggplot(aes(x = fct_infreq(drugever),
y = prop.table(stat(count)),
fill = fct_infreq(drugever),
label = scales::percent(prop.table(stat(count))))) +
geom_bar() +
geom_text(aes(label = sprintf('%s (%.1f%%)', after_stat(count), after_stat(count / sum(count) * 100))), # show counts & %
stat='count',
position = position_dodge(.9),
vjust = -1,
size = 3) +
scale_y_continuous(labels = scales::label_percent(accuracy = 1)) +
labs(title="Survey Makeup (2007) \n by Drug Use",
x = 'Ever Taken Drugs',
y = 'Percentage',
fill = 'Drug Use',
caption = "(Test Footnote 2021)") +
theme(plot.caption = element_text(hjust = 0),
plot.title = element_text(hjust = 0.5)) +
annotate("text", x = 2.3, y = .90, size = 3, label = "(total n = 7,403)") +
annotate("text", x = 2.3, y = .85, size = 3, label = "n = 7,357")
# weighted evrdrugs
ggsurvey(weight_pms07) +
(aes(x = fct_infreq(drugever),
y = prop.table(stat(count)),
fill = fct_infreq(drugever),
label = scales::percent(prop.table(stat(count))))) +
geom_bar() +
geom_text(aes(label = sprintf('%01.f (%.1f%%)', after_stat(count), after_stat(count / sum(count) * 100))), # show counts & %
stat='count',
position = position_dodge(.9),
vjust = -1,
size = 3) +
scale_y_continuous(labels = scales::label_percent(accuracy = 1)) +
labs(title="Weighted Survey Makeup (2007) \n by by Drug Use",
x = 'Ever Taken Drugs',
y = 'Percentage',
fill = 'Drug Use',
caption = "test") +
theme(plot.caption = element_text(hjust = 0),
plot.title = element_text(hjust = 0.5),
axis.text.x = element_text(angle = 45, hjust=1)) + # angle text
annotate("text", x = 3.0, y = .85, size = 3, label = "(total n = 7,403)") +
annotate("text", x = 3.0, y = .80, size = 3, label = "n = 7,403")
# Sex
subset_pms07 %>%
drop_na() %>%
ggplot(aes(x = fct_infreq(res_sex),
y = prop.table(stat(count)),
fill = fct_infreq(res_sex),
label = scales::percent(prop.table(stat(count))))) +
geom_bar() +
geom_text(aes(label = sprintf('%s (%.1f%%)', after_stat(count), after_stat(count / sum(count) * 100))), # show counts & %
stat='count',
position = position_dodge(.9),
vjust = -1,
size = 3) +
scale_y_continuous(labels = scales::percent) +
labs(title="Survey Makeup (2007)\n by Sex",
x = 'Respondant Sex',
y = 'Percentage',
fill = 'Sex',
caption = "(Test Footnote 2021)") +
theme(plot.caption = element_text(hjust = 0),
plot.title = element_text(hjust = 0.5)) +
annotate("text", x = 2.3, y = .70, size = 3, label = "(total n = 7,403)") +
annotate("text", x = 2.3, y = .65, size = 3, label = "n = 7,403")
# weighted sex gender
ggsurvey(weight_pms07) +
(aes(x = fct_infreq(res_sex),
y = prop.table(stat(count)),
fill = fct_infreq(res_sex),
label = scales::percent(prop.table(stat(count))))) +
geom_bar() +
geom_text(aes(label = sprintf('%01.f (%.1f%%)', after_stat(count), after_stat(count / sum(count) * 100))), # show counts & %
stat='count',
position = position_dodge(.9),
vjust = -1,
size = 3) +
scale_y_continuous(labels = scales::label_percent(accuracy = 1)) +
labs(title="Weighted Survey Makeup (2007) \n by by Sex",
x = 'Respondant Sex',
y = 'Percentage',
fill = 'Sex',
caption = "test") +
theme(plot.caption = element_text(hjust = 0),
plot.title = element_text(hjust = 0.5),
axis.text.x = element_text(angle = 45, hjust=1)) + # angle text
annotate("text", x = 2.0, y = .60, size = 3, label = "(total n = 7,403)") +
annotate("text", x = 2.0, y = .58, size = 3, label = "n = 7,403")
# example model for code
# regression - provide model
mod1 <- glm(dvilo4a ~ diag + age10yr,
data = subset_pms07,
family = poisson())
# example model for code
# regression - provide model
mod1 <- glm(dvilo4a ~ diag + age10yr,
data = subset_pms07,
family = binomial())
# example model for code
# regression - provide model
mod1 <- glm(dvilo4a ~ diag + age10yr,
data = subset_pms07,
family = "poisson"())
# example model for code
# regression - provide model
mod1 <- glm(diag ~ dvilo4a + age10yr + edqual5, data = weight_pms07,
data = subset_pms07,
family = "poisson"())
# example model for code
# regression - provide model
mod1 <- glm(diag ~ dvilo4a + age10yr + edqual5,
data = subset_pms07,
family = "poisson"())
# example model for code
# regression - provide model
mod1 <- glm(diag ~ dvilo4a + age10yr + edqual5,
data = subset_pms07,
family = "binominal"())
# example model for code
# regression - provide model
mod1 <- glm(diag ~ dvilo4a + age10yr + edqual5,
data = subset_pms07,
family = binominal())
#install.packages if not already
# load libraries
pacman::p_load(skimr,
naniar,
gtsummary,
finalfit,
knitr,
tidyverse,
haven,
ggplot2,
forcats,
janitor,
survey,
srvyr,
questionr,
ggpubr,
reprex)
# example model for code
# regression - provide model
mod1 <- glm(diag ~ dvilo4a + age10yr + edqual5,
data = subset_pms07,
family = binominal())
# example model for code
# regression - provide model
mod1 <- glm(diag ~ dvilo4a + age10yr + edqual5,
data = subset_pms07,
family = binominal)
# example model for code
# regression - provide model
mod1 <- glm(diag ~ dvilo4a + age10yr + edqual5,
data = subset_pms07,
family = binomial())
mod1 %>%
tbl_regression(exponentiate = TRUE) %>%
bold_labels() %>%
bold_p(t = .1)
# example model for code
# regression - provide model
mod1 <- glm(dvilo4a ~ diag  + age10yr,
data = subset_pms07,
family = binomial())
# example model for code
# regression - provide model
mod1 <- glm(dvilo4a ~ diag  + age10yr + edqual5,
data = subset_pms07,
family = binomial())
# example model for code
# regression - provide model
mod1 <- glm(dvilo4a ~ diag  + age10yr + edqual5,
data = subset_pms07,
family = binomial())
# example model for code
# regression - provide model
mod1 <- glm(dvilo4a ~ diag  + age10yr + edqual5,
data = subset_pms07,
family = binomial())
# example model for code
# regression - provide model
mod1 <- glm(dvilo4a ~ diag  + age10yr + edqual5,
data = subset_pms07,
family = binomial())
# example model for code
# regression - provide model
mod1 <- glm(diag ~ dvilo4a  + age10yr + edqual5,
data = subset_pms07,
family = binomial())
mod1 %>%
tbl_regression(exponentiate = TRUE) %>%
bold_labels() %>%
bold_p(t = .1)
# example model for code
# regression - provide model
mod1 <- glm(diag ~ dvilo4a  + age10yr + edqual5, data = diag,
data = subset_pms07,
family = binomial())
# example model for code
# regression - provide model
mod1 <- glm(diag ~ dvilo4a  + age10yr + edqual5,
data = subset_pms07,
family = binomial())
mod1 %>%
tbl_regression(exponentiate = TRUE) %>%
bold_labels() %>%
bold_p(t = .1)
# example model for code
# regression - provide model
mod1 <- glm(diag ~ dvilo4a  + age10yr + edqual5,
data = subset_pms07,
family = poisson())
# example model for code
# regression - provide model
mod1 <- glm(diag ~ dvilo4a  + age10yr + edqual5,
data = subset_pms07,
family = binominal())
# example model for code
# regression - provide model
mod1 <- glm(diag ~ dvilo4a  + age10yr + edqual5,
data = subset_pms07,
family = binomial())
mod1 %>%
tbl_regression(exponentiate = TRUE) %>%
bold_labels() %>%
bold_p(t = .1)
summary(mod1)
mod1 %>%
tbl_regression(exponentiate = TRUE) %>%
bold_labels() %>%
bold_p(t = .1)
mod1 %>%
tbl_regression(exponentiate = TRUE) %>%
bold_labels() %>%
bold_p(t = .5)
mod1 %>%
tbl_regression(exponentiate = TRUE) %>%
bold_labels() %>%
bold_p(t = .1)
getwd()
ifelse(!dir.exists("apms_phd"), dir.create("apms_phd"), "Folder already exists")
